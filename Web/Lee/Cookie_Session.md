## Cookie & Session

`HTTP` 는 `stateless` 와 `connectionless` 특징을 가지고 있다.

다시 한 번 정리하자면 다음과 같다.

- 무상태(`stateless`)
    - 클라이언트와 서버의 연결이 끊어지고 통신이 끝날 때, 상태를 유지하지 않는다.
    - 클라이언트의 이전 상황을 알 수 없다.
- 비연결성(`connectionless`)
    - 클라이언트 → 클라이언트의 요청 → 서버 → 서버의 응답 → 클라이언트
      이렇게 한 사이클이 끝나면, 바로 연결을 끊는다.
    - 클라이언트/서버 구조에서 최대 연결 수보다 훨씬 많은 요청/응답을 처리할 수 있다.

> 연결 해제 후에 상태 정보를 저장하지 않기 때문에 서버의 자원을 아낄 수 있다는 장점이 있지만, 서버는 클라이언트를 식별할 수 없다는 단점이 있다.
>

### 이를 대처하기 위해, `Cookie`와 `Session`을 사용한다.

---

## Cookie

<aside>
💡 쿠키란 서버가 클라이언트의 웹 브라우저에 저장하는 데이터이다.

</aside>

> 웹 서버는 쿠키를 이용해서 웹 브라우저에 정보를 전송할 수 있고 웹 서버로부터 쿠키를 전달받은 웹 브라우저는 웹 서버에 요청할 때 쿠키를 함께 전송한다.
쿠키를 사용하면 서버와 브라우저는 데이터를 공유하고 상태 유지할 수 있다.
>

### **쿠키 동작방식**

1. 클라이언트의 요청
2. 웹 서버에서 쿠키를 생성
3. 응답 시에 HTTP 헤더에 쿠키를 포함하여 전달
4. client 로컬 pc에 쿠키 저장
5. 브라우저가 만료되어도 지정된 기간까지 클라이언트에서 보관
6. 동일 요청시, 쿠키가 존재하면 HTTP 헤더에 쿠키를 포함하여 전달
7. 서버에서 쿠키를 읽어, 이전 상태 정보를 변경 할 필요가 있을 때 쿠키를 업데이트하여 변경된 쿠키를 HTTP 헤더에 포함시켜 응답
8. 사용 예 ID 저장(자동 로그인), 일주일간 다시 보지 않기, 최근 검색한 상품들을 광고에 추천, 쇼핑몰 장바구니

---

## Session

<aside>
💡 일정 시간 동안 같은 클라이언트로부터 들어오는 요청을 상태로 보고, 그 상태를 유지하는 기술이다.

</aside>

> 아이디나 비밀번호 정보를 쿠키를 통해 전달하는 방법이 있지만, 이 경우 보안상 문제가 되므로, 세션을 이용한다.
중요한 정보는 클라이언트가 아니라 서버에 저장하기 때문에 클라이언트 정보가 노출되지 않는다.
세션은 비밀번호가 아니라 (클라이언트의 식별자인) 세션 키를 만들어서 쿠키에 저장하고, 세션 키를 클라이언트에 전달한다.
>

### **세션 동작방식**

1. 클라이언트의 요청
2. 서버에 요청 시, `session id`를 서버에 전달
3. 서버는 클라이언트의 `HTTP request header`의 필드인 `Cookie`를 확인하고, 어떤 `session id`를 보냈는지 확인
4. 지정된 `session id`가 없다면 생성하여 클라이언트에게 전달
5. `session id`를 서버에 저장
6. 클라이언트 재접속 시, 가지고 있는 `session id` 값을 서버에 전달

## **** 쿠키와 세션의 차이에 대해 이야기할 때, 라이프사이클이 가장 중요함! ****

|  | 쿠키 | 세션 |
| --- | --- | --- |
| 저장위치 | Client | Server |
| 저장형식 | Text | Object |
| 라이프사이클 | 쿠키에 지정된 기간까지 | 브라우저 종료될 때 까지 |
| 용량제한 | ~4KB | 서버가 허용하는 한, 제한 없음 |
| 속도 | 빠름 | 느림 |
| 보안 | 나쁨 | 좋음 |
- 라이프사이클
    - 쿠키: 지정한 기간까지 브라우저를 종료해도 계속 남아 있는다.
    - 세션: 만료시간을 지정할 수 있지만, 브라우저가 종료하면 만료시간에 상관없이 삭제된다.
- 속도
    - 쿠키: 클라이언트에 모든 데이터가 저장되어 있어서 서버에 요청할 때 속도가 빠르다.
    - 세션: 실제 저장된 정보가 서버에 있어, 서버에서 처리가 필요해 속도가 느리다.
- 보안
    - 쿠키: 클라이언트에 저장되므로 보안에 취약하다.
    - 세션: 쿠키를 이용해 session id만 저장하고, 서버에서 id를 보고 처리하므로 비교적으로 보안이 좋다.